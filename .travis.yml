sudo: required

services:
  - docker

language: perl
perl:
  - "5.24"
env:
  - LANG=EN ZABBIX_VERSION=3.4
  - LANG=RU ZABBIX_VERSION=3.4
  - LANG=EN ZABBIX_VERSION=3.2
  - LANG=RU ZABBIX_VERSION=3.2
before_install:
  - cpanm --install JSON::XS
  - cpanm --install LWP
  - python -m pip install --user py-zabbix
  - pushd tests/docker && docker-compose up -d
  - popd
  - pushd bin
  - while ! python check-api.py; do sleep 5; done
  - popd

install: true  


script:
  - pushd bin
  - perl import-templates.pl --api_url='http://localhost/api_jsonrpc.php' -u Admin -p zabbix --filter ${LANG} ../out/module/${ZABBIX_VERSION}/${LANG}
  - perl import-templates.pl --api_url='http://localhost/api_jsonrpc.php' -u Admin -p zabbix --filter ${LANG} ../out/net/${ZABBIX_VERSION}/${LANG}
  - perl import-templates.pl --api_url='http://localhost/api_jsonrpc.php' -u Admin -p zabbix --filter ${LANG} ../out/os/${ZABBIX_VERSION}/${LANG}
  - perl import-templates.pl --api_url='http://localhost/api_jsonrpc.php' -u Admin -p zabbix --filter ${LANG} ../out/server/${ZABBIX_VERSION}/${LANG}
